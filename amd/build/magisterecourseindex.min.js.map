{"version":3,"sources":["../src/magisterecourseindex.js"],"names":["define","$","log","cfg","magisterecourseindex","init","args","bind","goto_course","load_course_detail","close_course_detail","submitfilters","toggle","search_form_submit","length","opencurrenttree","replace","cattoopen","trigger","debug","submit","ev","keycode","keyCode","which","url","wwwroot","val","window","location","that","waiter","html","coursebox","closest","attr","get","data","addClass","css","removeClass","target","toggleid","src","hasClass","current","parents","each"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for controlling the sections.\n *\n * @module     local_courseindex/magisterecourseindex\n * @package    local_courseindex\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// jshint unused: true, undef:true\ndefine(['jquery', 'core/log', 'core/config'], function($, log, cfg) {\n\n    var magisterecourseindex = {\n\n        init: function(args) {\n\n            $('.courseindex-coursethumb.direct').bind('click', this.goto_course);\n            $('.courseindex-coursename.direct').bind('click', this.goto_course);\n            $('.courseindex-coursethumb.detailed').bind('click', this.load_course_detail);\n            $('.courseindex-coursename.detailed').bind('click', this.load_course_detail);\n            $('.courseindex-readmorelink').bind('click', this.load_course_detail);\n            $('.modal-close').bind('click', this.close_course_detail);\n            $('.courseindex-filter-value').bind('change', this.submitfilters);\n\n            $('.ftoggle-handle').bind('click', this.toggle);\n            $('#courseindex-modal-shadow').bind('click', this.close_course_detail);\n\n            $('#search-input').bind('keypress', this.search_form_submit);\n\n            if ($('#courseindex-nav').length) {\n                // If in browser.\n                magisterecourseindex.opencurrenttree();\n            }\n\n            args = args.replace(/,/g, '-');\n            var cattoopen = '#ftoggle-handle' + args;\n            $(cattoopen).trigger('click');\n\n            log.debug(\"AMD local_courseindex magistere module init.\");\n        },\n\n        submitfilters: function () {\n            $('#courseindex-magistere-filter-form').submit();\n        },\n\n        search_form_submit: function(ev) {\n            var keycode = (ev.keyCode ? ev.keyCode : ev.which);\n            if (keycode == '13') {\n                var url = cfg.wwwroot + '/local/courseindex/explorer.php';\n                url += '?lpstatus=';\n                url += '&searchtext=' + $('#search-input').val();\n                url += '&title=1&description=1&go_freesearch=Chercher';\n\n                window.location = url;\n            }\n        },\n\n        // magistere layout related additions.\n        // loads a course description or public front page cover in the detail panel\n        load_course_detail: function() {\n\n            var that = $(this);\n\n            var waiter = '<div class=\"centered\"><center><img id=\"detail-waiter\" src=\"';\n            waiter += cfg.wwwroot + '/pix/i/ajaxloader.gif\" /></center></div>';\n            $('#courseindex-course-detail-content').html(waiter);\n            $('#courseindex-course-detail-actions').html(waiter);\n            var coursebox = that.closest('.local-courseindex-fp-coursebox');\n\n            // Self adapts when \"page\" format is installed.\n            // @see https://github.com/vfremaux/moodle-format_page\n            if (coursebox.attr('data-format') === 'page') {\n                // invokes a pure page content view. with no side blocks.\n                var url = cfg.wwwroot + '/course/format/page/viewpage.php';\n                url += '?id=' + coursebox.attr('data-course');\n                url += '&page=' + coursebox.attr('data-page');\n\n                $.get(url, function(data) {\n                    $('#courseindex-course-detail-content').html(data);\n                }, 'html');\n            } else {\n                // invokes a standard course info panel.\n                var url = cfg.wwwroot + '/local/courseindex/pro/ajax/viewcourse.php';\n                url += '?id=' + coursebox.attr('data-course');\n\n                $.get(url, function(data) {\n                    $('#courseindex-course-detail-content').html(data);\n                }, 'html');\n            }\n\n            // Invokes the action fragment.\n            var url = cfg.wwwroot + '/local/courseindex/pro/ajax/courseactions.php';\n            url += '?id=' + coursebox.attr('data-course');\n\n            $.get(url, function(data) {\n                $('#courseindex-course-detail-actions').html(data);\n            }, 'html');\n\n            $('body').addClass('courseindex-detail-open');\n            $('#courseindex-modal-shadow').css('display', 'block');\n        },\n\n        close_course_detail: function() {\n            $('body').removeClass('courseindex-detail-open');\n            $('#courseindex-modal-shadow').css('display', 'none');\n        },\n\n        goto_course: function() {\n            var that = $(this);\n\n            var coursebox = that.closest('.local-courseindex-fp-coursebox');\n            var url = cfg.wwwroot + '/course/view.php';\n            url += '?id=' + coursebox.attr('data-course');\n            window.location = url;\n        },\n\n        toggle: function() {\n            var that = $(this);\n\n            var target = that.attr('data-toggle');\n            var toggleid = target.replace('toggle-', '');\n\n            if ($('#' + target).css('display') === 'none') {\n                $('#' + target).css('display', 'block');\n                var src = $('#ftoggle-handle-' + toggleid + ' img').attr('src');\n                if (src) {\n                    src.replace('collapsed', 'expanded');\n                }\n                $('#ftoggle-handle-' + toggleid + ' img').attr('src', src);\n                if ($('#ftoggle-handle-' + toggleid + ' i').hasClass('fa-caret-down')) {\n                    $('#ftoggle-handle-' + toggleid + ' i').removeClass('fa-caret-down');\n                    $('#ftoggle-handle-' + toggleid + ' i').addClass('fa-caret-up');\n                } else {\n                    $('#ftoggle-handle-' + toggleid + ' i').removeClass('fa-plus-square');\n                    $('#ftoggle-handle-' + toggleid + ' i').addClass('fa-minus-square');\n                }\n            } else {\n                $('#' + target).css('display', 'none');\n                var src = $('#ftoggle-handle-' + toggleid + ' img').attr('src');\n                if (src) {\n                    src.replace('expanded', 'collapsed');\n                }\n                $('#ftoggle-handle-' + toggleid + ' img').attr('src', src);\n                if ($('#ftoggle-handle-' + toggleid + ' i').hasClass('fa-caret-up')) {\n                    $('#ftoggle-handle-' + toggleid + ' i').removeClass('fa-caret-up');\n                    $('#ftoggle-handle-' + toggleid + ' i').addClass('fa-caret-down');\n                } else {\n                    $('#ftoggle-handle-' + toggleid + ' i').removeClass('fa-minus-square');\n                    $('#ftoggle-handle-' + toggleid + ' i').addClass('fa-plus-square');\n                }\n            }\n        },\n\n        opencurrenttree: function() {\n            var current = $('.is-current');\n            var parents = current.parents('.subcats');\n            var target;\n            var toggleid;\n            var that;\n\n            parents.each(function() {\n                // open each parent up to the top.\n                that = $(this);\n                target = that.attr('id');\n                toggleid = target.replace('toggle-', '');\n                that.css('display', 'block');\n                var src = $('#ftoggle-handle-' + toggleid + ' img').attr('src');\n                if (src) {\n                    src.replace('collapsed', 'expanded');\n                }\n                if ($('#ftoggle-handle-' + toggleid + ' i').hasClass('fa-caret-down')) {\n                    $('#ftoggle-handle-' + toggleid + ' i').removeClass('fa-caret-down');\n                    $('#ftoggle-handle-' + toggleid + ' i').addClass('fa-caret-up');\n                } else {\n                    $('#ftoggle-handle-' + toggleid + ' i').removeClass('fa-plus-square');\n                    $('#ftoggle-handle-' + toggleid + ' i').addClass('fa-minus-square');\n                }\n                $('#ftoggle-handle-' + toggleid + ' img').attr('src', src);\n            });\n        }\n\n    };\n\n    return magisterecourseindex;\n});"],"file":"magisterecourseindex.min.js"}