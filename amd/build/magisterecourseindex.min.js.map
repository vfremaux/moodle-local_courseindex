{"version":3,"file":"magisterecourseindex.min.js","sources":["../src/magisterecourseindex.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for controlling the sections.\n *\n * @module     local_courseindex/magisterecourseindex\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// jshint unused: true, undef:true\ndefine(['jquery', 'core/log', 'core/config'], function($, log, cfg) {\n\n    var magisterecourseindex = {\n\n        init: function(args) {\n\n            $('.courseindex-coursethumb.direct').bind('click', this.goto_course);\n            $('.courseindex-coursename.direct').bind('click', this.goto_course);\n            $('.courseindex-coursethumb.detailed').bind('click', this.load_course_detail);\n            $('.courseindex-coursename.detailed').bind('click', this.load_course_detail);\n            $('.courseindex-readmorelink').bind('click', this.load_course_detail);\n            $('.modal-close').bind('click', this.close_course_detail);\n            $('.courseindex-filter-value').bind('change', this.submitfilters);\n\n            $('.ftoggle-handle').bind('click', this.toggle);\n            $('#courseindex-modal-shadow').bind('click', this.close_course_detail);\n\n            $('#search-input').bind('keypress', this.search_form_submit);\n\n            if ($('#courseindex-nav').length) {\n                // If in browser.\n                magisterecourseindex.opencurrenttree();\n            }\n\n            args = args.replace(/,/g, '-');\n            var cattoopen = '#ftoggle-handle' + args;\n            $(cattoopen).trigger('click');\n\n            log.debug(\"AMD local_courseindex magistere module init.\");\n        },\n\n        submitfilters: function () {\n            $('#courseindex-magistere-filter-form').submit();\n        },\n\n        search_form_submit: function(ev) {\n            var keycode = (ev.keyCode ? ev.keyCode : ev.which);\n            if (keycode == '13') {\n                var url = cfg.wwwroot + '/local/courseindex/explorer.php';\n                url += '?lpstatus=';\n                url += '&searchtext=' + $('#search-input').val();\n                url += '&title=1&description=1&go_freesearch=Chercher';\n\n                window.location = url;\n            }\n        },\n\n        // magistere layout related additions.\n        // loads a course description or public front page cover in the detail panel\n        load_course_detail: function() {\n\n            var that = $(this);\n\n            var waiter = '<div class=\"centered\"><center><img id=\"detail-waiter\" src=\"';\n            waiter += cfg.wwwroot + '/pix/i/ajaxloader.gif\" /></center></div>';\n            $('#courseindex-course-detail-content').html(waiter);\n            $('#courseindex-course-detail-actions').html(waiter);\n            var coursebox = that.closest('.local-courseindex-fp-coursebox');\n\n            // Self adapts when \"page\" format is installed.\n            // @see https://github.com/vfremaux/moodle-format_page\n            if (coursebox.attr('data-format') === 'page') {\n                // invokes a pure page content view. with no side blocks.\n                var url = cfg.wwwroot + '/course/format/page/viewpage.php';\n                url += '?id=' + coursebox.attr('data-course');\n                url += '&page=' + coursebox.attr('data-page');\n\n                $.get(url, function(data) {\n                    $('#courseindex-course-detail-content').html(data);\n                }, 'html');\n            } else {\n                // invokes a standard course info panel.\n                var url = cfg.wwwroot + '/local/courseindex/pro/ajax/viewcourse.php';\n                url += '?id=' + coursebox.attr('data-course');\n\n                $.get(url, function(data) {\n                    $('#courseindex-course-detail-content').html(data);\n                }, 'html');\n            }\n\n            // Invokes the action fragment.\n            var url = cfg.wwwroot + '/local/courseindex/pro/ajax/courseactions.php';\n            url += '?id=' + coursebox.attr('data-course');\n\n            $.get(url, function(data) {\n                $('#courseindex-course-detail-actions').html(data);\n            }, 'html');\n\n            $('body').addClass('courseindex-detail-open');\n            $('#courseindex-modal-shadow').css('display', 'block');\n        },\n\n        close_course_detail: function() {\n            $('body').removeClass('courseindex-detail-open');\n            $('#courseindex-modal-shadow').css('display', 'none');\n        },\n\n        goto_course: function() {\n            var that = $(this);\n\n            var coursebox = that.closest('.local-courseindex-fp-coursebox');\n            var url = cfg.wwwroot + '/course/view.php';\n            url += '?id=' + coursebox.attr('data-course');\n            window.location = url;\n        },\n\n        toggle: function() {\n            var that = $(this);\n\n            var target = that.attr('data-toggle');\n            var toggleid = target.replace('toggle-', '');\n\n            if ($('#' + target).css('display') === 'none') {\n                $('#' + target).css('display', 'block');\n                var src = $('#ftoggle-handle-' + toggleid + ' img').attr('src');\n                if (src) {\n                    src.replace('collapsed', 'expanded');\n                }\n                $('#ftoggle-handle-' + toggleid + ' img').attr('src', src);\n                if ($('#ftoggle-handle-' + toggleid + ' i').hasClass('fa-caret-down')) {\n                    $('#ftoggle-handle-' + toggleid + ' i').removeClass('fa-caret-down');\n                    $('#ftoggle-handle-' + toggleid + ' i').addClass('fa-caret-up');\n                } else {\n                    $('#ftoggle-handle-' + toggleid + ' i').removeClass('fa-plus-square');\n                    $('#ftoggle-handle-' + toggleid + ' i').addClass('fa-minus-square');\n                }\n            } else {\n                $('#' + target).css('display', 'none');\n                var src = $('#ftoggle-handle-' + toggleid + ' img').attr('src');\n                if (src) {\n                    src.replace('expanded', 'collapsed');\n                }\n                $('#ftoggle-handle-' + toggleid + ' img').attr('src', src);\n                if ($('#ftoggle-handle-' + toggleid + ' i').hasClass('fa-caret-up')) {\n                    $('#ftoggle-handle-' + toggleid + ' i').removeClass('fa-caret-up');\n                    $('#ftoggle-handle-' + toggleid + ' i').addClass('fa-caret-down');\n                } else {\n                    $('#ftoggle-handle-' + toggleid + ' i').removeClass('fa-minus-square');\n                    $('#ftoggle-handle-' + toggleid + ' i').addClass('fa-plus-square');\n                }\n            }\n        },\n\n        opencurrenttree: function() {\n            var current = $('.is-current');\n            var parents = current.parents('.subcats');\n            var target;\n            var toggleid;\n            var that;\n\n            parents.each(function() {\n                // open each parent up to the top.\n                that = $(this);\n                target = that.attr('id');\n                toggleid = target.replace('toggle-', '');\n                that.css('display', 'block');\n                var src = $('#ftoggle-handle-' + toggleid + ' img').attr('src');\n                if (src) {\n                    src.replace('collapsed', 'expanded');\n                }\n                if ($('#ftoggle-handle-' + toggleid + ' i').hasClass('fa-caret-down')) {\n                    $('#ftoggle-handle-' + toggleid + ' i').removeClass('fa-caret-down');\n                    $('#ftoggle-handle-' + toggleid + ' i').addClass('fa-caret-up');\n                } else {\n                    $('#ftoggle-handle-' + toggleid + ' i').removeClass('fa-plus-square');\n                    $('#ftoggle-handle-' + toggleid + ' i').addClass('fa-minus-square');\n                }\n                $('#ftoggle-handle-' + toggleid + ' img').attr('src', src);\n            });\n        }\n\n    };\n\n    return magisterecourseindex;\n});"],"names":["define","$","log","cfg","magisterecourseindex","init","args","bind","this","goto_course","load_course_detail","close_course_detail","submitfilters","toggle","search_form_submit","length","opencurrenttree","replace","trigger","debug","submit","ev","keyCode","which","url","wwwroot","val","window","location","that","waiter","html","coursebox","closest","attr","get","data","addClass","css","removeClass","src","target","toggleid","hasClass","parents","each"],"mappings":"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"}